<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <title>浏览器缓存 | 面试API</title>
    <meta name="description" content="前端面试API，自检清单，公众号推荐" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="浏览器缓存 | 面试API" />
    <meta property="og:site_name" content="浏览器缓存 | 面试API" />
    <meta property="og:locale" content="zh-CN" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="浏览器缓存 | 面试API" />
    <link rel="shortut icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.5f1fa08a.css" as="style"><link rel="preload" href="/assets/js/app.e48c3d44.js" as="script"><link rel="preload" href="/assets/js/1.9aa2b147.js" as="script"><link rel="preload" href="/assets/js/6.ab6f709e.js" as="script"><link rel="preload" href="/assets/js/5.0f5d195d.js" as="script"><link rel="preload" href="/assets/js/8.b943e6ee.js" as="script"><link rel="preload" href="/assets/js/11.fb958432.js" as="script"><link rel="preload" href="/assets/js/7.a46ab4a3.js" as="script"><link rel="preload" href="/assets/js/57.f744e726.js" as="script"><link rel="preload" href="/assets/js/16.f738196f.js" as="script"><link rel="prefetch" href="/assets/js/10.175139c9.js"><link rel="prefetch" href="/assets/js/12.85f229b3.js"><link rel="prefetch" href="/assets/js/13.96b776c5.js"><link rel="prefetch" href="/assets/js/14.e8a31a31.js"><link rel="prefetch" href="/assets/js/15.79c8d111.js"><link rel="prefetch" href="/assets/js/17.c9beec15.js"><link rel="prefetch" href="/assets/js/18.311c5248.js"><link rel="prefetch" href="/assets/js/19.6a1d7086.js"><link rel="prefetch" href="/assets/js/20.3e55f9ce.js"><link rel="prefetch" href="/assets/js/21.8d277f89.js"><link rel="prefetch" href="/assets/js/22.d1bd9642.js"><link rel="prefetch" href="/assets/js/23.7db4a8c3.js"><link rel="prefetch" href="/assets/js/24.1cb17e4b.js"><link rel="prefetch" href="/assets/js/25.e05bfa14.js"><link rel="prefetch" href="/assets/js/26.66417429.js"><link rel="prefetch" href="/assets/js/27.e37ba2d1.js"><link rel="prefetch" href="/assets/js/28.9981806c.js"><link rel="prefetch" href="/assets/js/29.0afdd99a.js"><link rel="prefetch" href="/assets/js/30.d9df9218.js"><link rel="prefetch" href="/assets/js/31.9f122e57.js"><link rel="prefetch" href="/assets/js/32.3be6e805.js"><link rel="prefetch" href="/assets/js/33.bc58239e.js"><link rel="prefetch" href="/assets/js/34.5b4ce795.js"><link rel="prefetch" href="/assets/js/35.d5108ab9.js"><link rel="prefetch" href="/assets/js/36.6b511d0c.js"><link rel="prefetch" href="/assets/js/37.94b94dfb.js"><link rel="prefetch" href="/assets/js/38.d1f5520c.js"><link rel="prefetch" href="/assets/js/39.f4548d5d.js"><link rel="prefetch" href="/assets/js/4.2b5d276e.js"><link rel="prefetch" href="/assets/js/40.81df4ece.js"><link rel="prefetch" href="/assets/js/41.5c15cc5a.js"><link rel="prefetch" href="/assets/js/42.94194640.js"><link rel="prefetch" href="/assets/js/43.f7be967b.js"><link rel="prefetch" href="/assets/js/44.b7364342.js"><link rel="prefetch" href="/assets/js/45.a5be72ef.js"><link rel="prefetch" href="/assets/js/46.5dd241ea.js"><link rel="prefetch" href="/assets/js/47.d59f707a.js"><link rel="prefetch" href="/assets/js/48.866defb6.js"><link rel="prefetch" href="/assets/js/49.98fdaefc.js"><link rel="prefetch" href="/assets/js/50.3e139586.js"><link rel="prefetch" href="/assets/js/51.3fcba8e1.js"><link rel="prefetch" href="/assets/js/52.651a2d94.js"><link rel="prefetch" href="/assets/js/53.892cbb93.js"><link rel="prefetch" href="/assets/js/54.32e1b9ce.js"><link rel="prefetch" href="/assets/js/55.2db2bfa6.js"><link rel="prefetch" href="/assets/js/56.1ac7678c.js"><link rel="prefetch" href="/assets/js/58.0b48a602.js"><link rel="prefetch" href="/assets/js/59.6fd53a34.js"><link rel="prefetch" href="/assets/js/60.93edb351.js"><link rel="prefetch" href="/assets/js/61.1c5d6435.js"><link rel="prefetch" href="/assets/js/62.04e9e017.js"><link rel="prefetch" href="/assets/js/63.456f3577.js"><link rel="prefetch" href="/assets/js/64.a1c8d614.js"><link rel="prefetch" href="/assets/js/65.549a8c78.js"><link rel="prefetch" href="/assets/js/66.81658fbf.js"><link rel="prefetch" href="/assets/js/67.a7e6e80a.js"><link rel="prefetch" href="/assets/js/68.f119f6cf.js"><link rel="prefetch" href="/assets/js/69.79ea2aba.js"><link rel="prefetch" href="/assets/js/70.92112509.js"><link rel="prefetch" href="/assets/js/9.ba7c49dc.js"><link rel="prefetch" href="/assets/js/search.29d23745.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5f1fa08a.css">
  </head>
  <body>
    <div id="loader-wrapper" style="display: none;opacity:0">
      <div id="loader"></div>
      <div class="loader-section section-left"></div>
      <div class="loader-section section-right"></div>
    </div>
    <div id="app" data-server-rendered="true"><div data-v-8ae45032><section class="el-container" data-v-8ae45032><aside width="200px" class="el-aside menu" style="width:auto;" data-v-28ba16cc data-v-8ae45032><div class="brand-wrap" style="background-image:url(/aside.jpg);" data-v-28ba16cc><div class="brand" data-v-28ba16cc><a href="/" class="avatar waves-effect waves-circle waves-light router-link-active" data-v-28ba16cc><img src="/infoq1.png" data-v-28ba16cc></a> <hgroup class="introduce" data-v-28ba16cc><div class="nickname" data-v-28ba16cc><img src="/name.png" data-v-28ba16cc></div> <div data-v-28ba16cc><a title="253929992@qq.com" class="mail" data-v-28ba16cc>253929992@qq.com</a></div></hgroup></div></div> <ul role="menubar" class="menu-wrap el-menu" style="background-color:;" data-v-28ba16cc><li role="menuitem" aria-haspopup="true" aria-expanded="true" class="el-submenu is-opened" data-v-28ba16cc><div class="el-submenu__title" style="padding-left:20px;color:;background-color:;"><i class="iconfont icon-icon37" data-v-28ba16cc></i> <span slot="title" class="item-title" data-v-28ba16cc>自检清单</span><i class="el-submenu__icon-arrow el-icon-arrow-down"></i></div><ul role="menu" class="el-menu el-menu--inline" style="background-color:;"> <li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            JS基础
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            HTML&amp;CSS
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            计算机基础
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            数据结构和算法
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            运行环境
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            框架
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            工程化
          </span></li></ul></li><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-28ba16cc><i class="iconfont icon-shijianzhou" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
        时间轴
      </span></li><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-28ba16cc><i class="iconfont icon-guanyu" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
        个人档案
      </span></li></ul></aside> <section class="el-container container-warp" data-v-8ae45032><header id="topHeader" class="el-header top-header" style="height:60px;padding-left:300px;" data-v-7e316482 data-v-8ae45032><div class="header-warp el-row is-align-center el-row--flex" data-v-7e316482><div class="el-col el-col-2 el-col-xs-7" data-v-7e316482><button type="button" class="el-button header-btn el-button--primary el-button--mini is-circle" data-v-7e316482><!----><!----><span><i class="iconfont icon-rightjustified" data-v-7e316482></i></span></button></div> <div class="el-col el-col-10 el-col-xs-24" data-v-7e316482><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-2581" class="el-autocomplete search-input" data-v-7e316482><div class="el-input el-input--small el-input--suffix"><!----><input type="text" autocomplete="off" valueKey="value" popperClass="search-popper" placeholder="搜搜看" fetchSuggestions="function () { [native code] }" debounce="300" placement="bottom-start" popperAppendToBody="true" value="" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon el-icon-search search-ico" data-v-7e316482></i><!----></span><!----></span><!----></div><div role="region" class="el-autocomplete-suggestion el-popper search-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <div class="nav-col el-col el-col-8 el-col-offset-10 el-col-xs-24" data-v-7e316482><ul role="menubar" class="header-menu el-menu--horizontal el-menu" style="background-color:transparent;" data-v-7e316482><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:#fdf5ab;border-bottom-color:transparent;background-color:transparent;" data-v-7e316482>Home</li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:#ffd04b;border-bottom-color:#ffd04b;background-color:transparent;" data-v-7e316482>Blog</li></ul></div></div></header> <main class="el-main my-main" style="margin-left:238px;" data-v-47f536a8 data-v-8ae45032><div class="content-header index-header" style="background-image:url(/banner.jpg);" data-v-1ba67baf data-v-47f536a8><div class="container" data-v-1ba67baf><h1 id="conentHeader" class="title animated fadeInDown" data-v-1ba67baf>浏览器缓存</h1> <h5 class="subtitle" data-v-1ba67baf>最后更新时间：2019-11-21 16:13:47</h5> <div class="el-row is-align-center el-row--flex" data-v-47f536a8><div class="tag-card el-col el-col-20 el-col-xs-23 el-col-sm-22 el-col-md-22 el-col-lg-20" data-v-47f536a8><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Vue</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>AST抽象语法树</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>网络协议</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>工具函数</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>vue生命周期</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>性能优化</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>闭包</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>编译原理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS渲染原理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>回流与重绘</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>判断数据类型</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>this</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>执行上下文</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>高阶函数</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>浏览器缓存</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>HTML汇总</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>BFC</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Vue组件通信</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS盒模型</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS伪类</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>垂直居中</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS选择器</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>三栏布局</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>实现轮子</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>数据结构</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>算法</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>TypeScript</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>项目构建</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>版本控制</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>持续集成</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>开发提速</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>数据流管理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Nginx</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>编码能力</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>React</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>异常处理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>基础问题</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>作用域</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>执行机制</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>正则表达式</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>类型转换</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Symbol</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>原型和原型链</span></div></div></div></div> <div data-v-3a18dd0a data-v-47f536a8 data-v-47f536a8><div class="post-content el-row is-justify-center el-row--flex" data-v-3a18dd0a><div id="post-card" class="post-card post-sign el-col el-col-16 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-3a18dd0a><div class="content__default" data-v-3a18dd0a><h1 id="彻底理解浏览器缓存机制"><a href="#彻底理解浏览器缓存机制" aria-hidden="true" class="header-anchor">#</a> 彻底理解浏览器缓存机制</h1> <h2 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h2> <p>浏览器的缓存机制也就是我们说的 <code>HTTP</code> 缓存机制，其机制是根据 <code>HTTP</code> 报文的缓存标示进行的。</p> <p>所以在分析浏览器缓存之前，我们先使用图文简单介绍一下 <code>HTTP</code> 报文，<code>HTTP</code> 报文分为两种：</p> <ul><li><code>HTTP</code> 请求（<code>Request</code>）报文。报文格式为：
<ol><li><strong>请求行</strong>。</li> <li><strong><code>HTTP</code> 头</strong>（通用信息头，请求头，实体头）。</li> <li><strong>请求报文主体</strong>（只有 <code>POST</code> 才有报文主体)。</li></ol></li></ul> <p><img src="https://qiniu.mdnice.com/531b3efa6ddd37c8318f5f7cfed34931.png" alt="请求报文"> <img src="https://qiniu.mdnice.com/fa85fd3a79ee9989dae5f580ec39a941.png" alt="请求报文主体"></p> <ul><li><code>HTTP</code> 响应（<code>Response</code>）报文，报文格式为：
<ol><li><strong>状态行</strong>。</li> <li><code>HTTP</code> 头（通用信息头，响应头，实体头）。</li> <li><strong>响应报文主体</strong>。</li></ol></li></ul> <p><img src="https://qiniu.mdnice.com/0b5203c39d169ae326c715bd090674bd.png" alt="响应报文"> <img src="https://qiniu.mdnice.com/53513029f2fb2e561ad02e2d64a0c497.png" alt="响应报文主体"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>注：
通用信息头指的是请求和响应报文都支持的头域，分别为：Cache<span class="token operator">-</span>Control、Connection、Date、Pragma、Transfer<span class="token operator">-</span>Encoding、Upgrade、Via。
实体头则是实体信息的实体头域，分别为：Allow、Content<span class="token operator">-</span>Base、Content<span class="token operator">-</span>Encoding、Content<span class="token operator">-</span>Language、Content<span class="token operator">-</span>Length、Content<span class="token operator">-</span>Location、Content<span class="token operator">-</span><span class="token constant">MD5</span>、Content<span class="token operator">-</span>Range、Content<span class="token operator">-</span>Type、Etag、Expires、Last<span class="token operator">-</span>Modified、extension<span class="token operator">-</span>header。
这里只是为了方便理解，将通用信息头，响应头<span class="token operator">/</span>请求头，实体头都归为了<span class="token constant">HTTP</span>头。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以上的概念在这里我们不做多讲解，只简单介绍，有兴趣的童鞋可以自行研究。</p> <h2 id="缓存过程分析"><a href="#缓存过程分析" aria-hidden="true" class="header-anchor">#</a> 缓存过程分析</h2> <p>浏览器与服务器通信的方式为应答模式，即，浏览器发起 <code>HTTP</code> 请求 –&gt; 服务器响应该请求。</p> <p>那么浏览器第一次向服务器发起该请求后拿到请求结果，<strong>会根据响应报文中 <code>HTTP</code> 头的缓存标识，决定是否缓存结果，是则将请求结果和缓存标识存入浏览器缓存中</strong>，简单的过程如下图：</p> <p><img src="https://qiniu.mdnice.com/e111df7e85e6afc415fc3c4494a6b0cd.png" alt="第一次发起HTTP请求"></p> <p>由上图我们可以知道：</p> <ul><li>浏览器每次发起请求，都会先在浏览器缓存中查找该请求的结果以及缓存标识。</li> <li>浏览器每次拿到返回的请求结果都会将该结果和缓存标识存入浏览器缓存中。</li></ul> <p>以上两点结论就是浏览器缓存机制的关键，他确保了每个请求的缓存存入与读取，只要我们再理解浏览器缓存的使用规则，那么所有的问题就迎刃而解了，本文也将围绕着这点进行详细分析。</p> <p>为了方便大家理解，这里我们根据是否需要向服务器重新发起 <code>HTTP</code> 请求将缓存过程分为两个部分，分别是<strong>强制缓存</strong>和<strong>协商缓存</strong>。</p> <h3 id="强制缓存"><a href="#强制缓存" aria-hidden="true" class="header-anchor">#</a> 强制缓存</h3> <p>强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程，强制缓存的情况主要有三种：</p> <ul><li>不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求（跟第一次发起请求一致），如下图：</li></ul> <p><img src="https://qiniu.mdnice.com/21e4e59d92db2f9b2a23ed87d9de0a17.png" alt="强制缓存"></p> <ul><li>存在该缓存结果和缓存标识，但该结果已失效，强制缓存失效，则使用协商缓存(暂不分析)，如下图：</li></ul> <p><img src="https://qiniu.mdnice.com/f3177fb2e9ac086cbc65ebd351ba685d.png" alt="强制缓存"></p> <ul><li>存在该缓存结果和缓存标识，且该结果尚未失效，强制缓存生效，直接返回该结果，如下图：</li></ul> <p><img src="https://qiniu.mdnice.com/985df827046187a5d32d7dda76b5db48.png" alt="强制缓存"></p> <blockquote><p>那么强制缓存的缓存规则是什么？</p></blockquote> <p>当浏览器向服务器发起请求时，服务器会将缓存规则放入 <code>HTTP</code> 响应报文的 <code>HTTP</code> 头中和请求结果一起返回给浏览器，控制强制缓存的字段分别是 <code>Expires</code> 和 <code>Cache-Control</code>，其中 <code>Cache-Control</code> 优先级比<code>Expires</code> 高。</p> <h4 id="expires"><a href="#expires" aria-hidden="true" class="header-anchor">#</a> Expires</h4> <p><code>Expires</code> 是 <code>HTTP/1.0</code> 控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间，即再次发起该请求时，如果客户端的时间小于<code>Expires</code> 的值时，直接使用缓存结果。</p> <blockquote><p><code>Expires</code> 是 <code>HTTP/1.0</code> 的字段，但是现在浏览器默认使用的是 <code>HTTP/1.1</code>，那么在 <code>HTTP/1.1</code> 中网页缓存还是否由 <code>Expires</code> 控制？</p></blockquote> <p>到了 <code>HTTP/1.1</code>，<code>Expire</code> 已经被 <code>Cache-Control</code> 替代，原因在于 <code>Expires</code> 控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，那么如果客户端与服务端的时间因为某些原因（例如时区不同；客户端和服务端有一方的时间不准确）发生误差，那么强制缓存则会直接失效，这样的话强制缓存的存在则毫无意义，那么 <code>Cache-Control</code> 又是如何控制的呢？</p> <h4 id="cache-control"><a href="#cache-control" aria-hidden="true" class="header-anchor">#</a> Cache-Control</h4> <p>在 <code>HTTP/1.1</code> 中，<code>Cache-Control</code> 是最重要的规则，主要用于控制网页缓存，主要取值为：</p> <ul><li><p><code>public</code>：所有内容都将被缓存（客户端和代理服务器都可缓存）。</p></li> <li><p><code>private</code>：所有内容只有客户端可以缓存，<code>Cache-Control</code> 的默认取值。</p></li> <li><p><code>no-cache</code>：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定。</p></li> <li><p><code>no-store</code>：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存。</p></li> <li><p><code>max-age=xxx (xxx is numeric)</code>：缓存内容将在 <code>xxx</code> 秒后失效。</p></li></ul> <p>接下来，我们直接看一个例子，如下：</p> <p><img src="https://qiniu.mdnice.com/aed2f635e77f7b6c215655e214b9ae7f.png" alt="强制缓存"></p> <p>由上面的例子我们可以知道：</p> <p><code>HTTP</code> 响应报文中 <code>expires</code> 的时间值，是一个绝对值。</p> <p><code>HTTP</code> 响应报文中 <code>Cache-Control</code> 为 <code>max-age=600</code>，是相对值。</p> <p>由于 <code>Cache-Control</code> 的优先级比 <code>expires</code>，那么直接根据 <code>Cache-Control</code> 的值进行缓存，意思就是说在 <code>600</code> 秒内再次发起该请求，则会直接使用缓存结果，强制缓存生效。</p> <p>注：在无法确定客户端的时间是否与服务端的时间同步的情况下，<code>Cache-Control</code> 相比于 <code>expires</code> 是更好的选择，所以同时存在时，只有<code>Cache-Control</code> 生效。</p> <p>了解强制缓存的过程后，我们拓展性的思考一下：</p> <blockquote><p>浏览器的缓存存放在哪里，如何在浏览器中判断强制缓存是否生效？</p></blockquote> <p><img src="https://qiniu.mdnice.com/9ef4986f8ec16aebebd6f1caefd55d5d.png" alt="强制缓存"></p> <p>这里我们以博客的请求为例，状态码为灰色的请求则代表使用了强制缓存，请求对应的 <code>Size</code> 值则代表该缓存存放的位置，分别为 <code>from memory cache</code> 和 <code>from disk cache</code>。</p> <p>那么 <code>from memory cache</code> 和 <code>from disk cache</code> 又分别代表的是什么呢？什么时候会使用 <code>from disk cache</code>，什么时候会使用<code>from memory cache</code> 呢？</p> <p><code>from memory cache</code> 代表使用内存中的缓存，<code>from disk cache</code> 则代表使用的是硬盘中的缓存，浏览器读取缓存的顺序为 <code>memory –&gt; disk</code>。</p> <p>虽然我已经直接把结论说出来了，但是相信有不少人对此不能理解，那么接下来我们一起详细分析一下缓存读取问题，这里仍让以我的博客为例进行分析：</p> <ol><li>访问 <code>https://heyingye.github.io/</code> –&gt; <code>200</code></li> <li>关闭博客的标签页 –&gt; 重新打开 <code>https://heyingye.github.io/</code> –&gt; <code>200 (from disk cache)</code></li> <li>刷新 –&gt; <code>200(from memory cache)</code></li></ol> <blockquote><p>看到这里可能有人小伙伴问了，最后一个步骤刷新的时候，不是同时存在着 from disk cache 和 from memory cache 吗？</p></blockquote> <p>对于这个问题，我们需要了解内存缓存（<code>from memory cache</code>）和硬盘缓存（<code>from disk cache</code>），如下:</p> <ul><li><p>内存缓存(<code>from memory cache</code>)：内存缓存具有两个特点，分别是<strong>快速读取</strong>和<strong>时效性</strong>：</p> <ul><li><p><strong>快速读取</strong>：内存缓存会将编译解析后的文件，直接存入该进程的内存中，占据该进程一定的内存资源，以方便下次运行使用时的快速读取。</p></li> <li><p><strong>时效性</strong>：一旦该进程关闭，则该进程的内存则会清空。</p></li></ul></li> <li><p>硬盘缓存（<code>from disk cache</code>）：硬盘缓存则是直接将缓存写入硬盘文件中，读取缓存需要对该缓存存放的硬盘文件进行 <code>I/O</code> 操作，然后重新解析该缓存内容，读取复杂，速度比内存缓存慢。</p></li></ul> <p>在浏览器中，浏览器会在 <code>js</code> 和图片等文件解析执行后直接存入内存缓存中，那么当刷新页面时只需直接从内存缓存中读取；而 <code>css</code> 文件则会存入硬盘文件中，所以每次渲染页面都需要从硬盘读取缓存。</p> <h3 id="协商缓存"><a href="#协商缓存" aria-hidden="true" class="header-anchor">#</a> 协商缓存</h3> <p><strong>协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程</strong>。</p> <p>主要有以下两种情况：</p> <ul><li><p>协商缓存生效，返回 <code>304</code>，如下：</p> <p><img src="https://qiniu.mdnice.com/50e14b0a28494997d560d5395f3d6dae.png" alt="协商缓存"></p></li> <li><p>协商缓存失效，返回 <code>200</code> 和请求结果结果，如下：</p> <p><img src="https://qiniu.mdnice.com/49c53e602efbf8040a27b846bd923aea.png" alt="协商缓存"></p></li></ul> <p>同样，协商缓存的标识也是在响应报文的 <code>HTTP</code> 头中和请求结果一起返回给浏览器的，控制协商缓存的字段分别有：</p> <ul><li><code>Last-Modified / If-Modified-Since</code>.</li> <li><code>Etag / If-None-Match</code>.</li></ul> <p>其中 <code>Etag / If-None-Match</code> 的优先级比 <code>Last-Modified / If-Modified-Since</code> 高。</p> <h4 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" aria-hidden="true" class="header-anchor">#</a> Last-Modified / If-Modified-Since</h4> <ul><li><p><code>Last-Modified</code> 是服务器响应请求时，返回该资源文件在服务器最后被修改的时间，如下：</p> <p><img src="https://qiniu.mdnice.com/b883a3df793d3d330644b7351243a5e6.png" alt="协商缓存"></p></li> <li><p><code>If-Modified-Since</code> 则是客户端再次发起该请求时，携带上次请求返回的 <code>Last-Modified</code> 值，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。服务器收到该请求，发现请求头含有 <code>If-Modified-Since</code> 字段，则会根据 <code>If-Modified-Since</code> 的字段值与该资源在服务器的最后被修改时间做对比，若服务器的资源最后被修改时间大于 <code>If-Modified-Since</code> 的字段值，则重新返回资源，状态码为 <code>200</code>；否则则返回 <code>304</code>，代表资源无更新，可继续使用缓存文件，如下：</p> <p><img src="https://qiniu.mdnice.com/af737ad0211018faf7bb0dfbd47ff2d2.png" alt="协商缓存"></p></li></ul> <h4 id="etag-if-none-match"><a href="#etag-if-none-match" aria-hidden="true" class="header-anchor">#</a> Etag / If-None-Match</h4> <ul><li><p><code>Etag</code> 是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，如下：</p> <p><img src="https://qiniu.mdnice.com/a2a5ca7092f9d9ceb435317126fe112f.png" alt="协商缓存"></p></li> <li><p><code>If-None-Match</code> 是客户端再次发起该请求时，携带上次请求返回的唯一标识 <code>Etag</code> 值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值。服务器收到该请求后，发现该请求头中含有 <code>If-None-Match</code>，则会根据 <code>If-None-Match</code> 的字段值与该资源在服务器的 <code>Etag</code>值做对比，一致则返回 <code>304</code>，代表资源无更新，继续使用缓存文件；不一致则重新返回资源文件，状态码为 <code>200</code>，如下：</p> <p><img src="https://qiniu.mdnice.com/03ccaf19197565f16c59c81910d2f0ca.png" alt="协商缓存"></p></li></ul> <p>注：<code>Etag / If-None-Match</code> 优先级高于 <code>Last-Modified / If-Modified-Since</code>，同时存在则只有 <code>Etag / If-None-Match</code> 生效。</p> <h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <p>强制缓存优先于协商缓存进行，若强制缓存 <code>Expires</code> 和 <code>Cache-Control</code> 生效则直接使用缓存，若不生效则进行协商缓存（<code>Last-Modified / If-Modified-Since</code> 和 <code>Etag / If-None-Match</code>）。</p> <p>协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求结果，再存入浏览器缓存中；生效则返回    <code>304</code>，继续使用缓存，主要过程如下：</p> <p><img src="https://qiniu.mdnice.com/3e3cc0154d1a038b7caec00c50def728.png" alt="HTTP 缓存"></p> <p>以上便是浏览器缓存的过程，若有错误之处，敬请指正。</p></div> <span id="footerPost" data-v-3a18dd0a></span></div> <div id="post-toc" class="post-toc el-col el-col-6" data-v-3a18dd0a><div class="catalog-body" data-v-3a18dd0a><h4 class="catalog-title" data-v-3a18dd0a>目录</h4> <ul id="catalog-list" class="catalog-list" data-v-3a18dd0a></ul></div></div></div> <div class="el-row is-justify-center el-row--flex" data-v-3a18dd0a><div class="post-card vssue-wrap el-col el-col-21 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-3a18dd0a></div></div> <div class="post-nav el-row is-justify-space-around el-row--flex" data-v-3a18dd0a><div class="post-prev el-col el-col-7" data-v-3a18dd0a><div data-v-3a18dd0a><a href="/posts/Chapter1/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0.html" data-v-3a18dd0a><i class="el-icon-arrow-left" data-v-3a18dd0a></i> Prev
        </a> <p class="nav-title" data-v-3a18dd0a>高阶函数</p></div></div> <div class="post-next el-col el-col-7 el-col-lg-pull-5" data-v-3a18dd0a><div data-v-3a18dd0a><a href="/posts/Chapter2/html.html" data-v-3a18dd0a>
          Next
          <i class="el-icon-arrow-right" data-v-3a18dd0a></i></a> <p class="nav-title" data-v-3a18dd0a>HTML汇总</p></div></div></div> <span data-v-3f1acc1c data-v-3a18dd0a><button type="button" class="el-button toc-btn el-button--primary el-button--mini is-circle" data-v-3f1acc1c><!----><!----><span><i class="el-icon-tickets" data-v-3f1acc1c></i></span></button> <button type="button" class="el-button gotop-btn el-button--primary is-circle" data-v-3f1acc1c><!----><!----><span><i class="el-icon-arrow-up" data-v-3f1acc1c></i></span></button></span></div></main></section> <button type="button" class="el-button gotop-btn el-button--primary is-circle" style="display:none;" data-v-1918517c data-v-8ae45032><!----><!----><span><i class="el-icon-arrow-up" data-v-1918517c></i></span></button></section> <div class="overlay" data-v-8ae45032></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e48c3d44.js" defer></script><script src="/assets/js/1.9aa2b147.js" defer></script><script src="/assets/js/6.ab6f709e.js" defer></script><script src="/assets/js/5.0f5d195d.js" defer></script><script src="/assets/js/8.b943e6ee.js" defer></script><script src="/assets/js/11.fb958432.js" defer></script><script src="/assets/js/7.a46ab4a3.js" defer></script><script src="/assets/js/57.f744e726.js" defer></script><script src="/assets/js/16.f738196f.js" defer></script>
  </body>
</html>
