<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
    <title>作用域和闭包 | 面试API</title>
    <meta name="description" content="前端面试API，自检清单，公众号推荐" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="作用域和闭包 | 面试API" />
    <meta property="og:site_name" content="作用域和闭包 | 面试API" />
    <meta property="og:locale" content="zh-CN" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="作用域和闭包 | 面试API" />
    <link rel="shortut icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.c742bf60.css" as="style"><link rel="preload" href="/assets/js/app.1fed3379.js" as="script"><link rel="preload" href="/assets/js/1.1ddbcd0b.js" as="script"><link rel="preload" href="/assets/js/6.4b004479.js" as="script"><link rel="preload" href="/assets/js/5.4c567fbe.js" as="script"><link rel="preload" href="/assets/js/8.eae040db.js" as="script"><link rel="preload" href="/assets/js/11.4e97cf26.js" as="script"><link rel="preload" href="/assets/js/7.5e624306.js" as="script"><link rel="preload" href="/assets/js/26.8893ec62.js" as="script"><link rel="preload" href="/assets/js/16.737902ee.js" as="script"><link rel="prefetch" href="/assets/js/10.d736433b.js"><link rel="prefetch" href="/assets/js/12.9eb83265.js"><link rel="prefetch" href="/assets/js/13.2afe1d2c.js"><link rel="prefetch" href="/assets/js/14.64209925.js"><link rel="prefetch" href="/assets/js/15.a3e8e4cc.js"><link rel="prefetch" href="/assets/js/17.93995b1d.js"><link rel="prefetch" href="/assets/js/18.495fb236.js"><link rel="prefetch" href="/assets/js/19.8de32ff1.js"><link rel="prefetch" href="/assets/js/20.0ac526d6.js"><link rel="prefetch" href="/assets/js/21.43d74702.js"><link rel="prefetch" href="/assets/js/22.512ab14f.js"><link rel="prefetch" href="/assets/js/23.7db4a8c3.js"><link rel="prefetch" href="/assets/js/24.bb8be84b.js"><link rel="prefetch" href="/assets/js/25.f2631670.js"><link rel="prefetch" href="/assets/js/27.8ba9faa8.js"><link rel="prefetch" href="/assets/js/28.1abfa8f7.js"><link rel="prefetch" href="/assets/js/29.0f83c879.js"><link rel="prefetch" href="/assets/js/30.ab09733f.js"><link rel="prefetch" href="/assets/js/31.a2bb5afc.js"><link rel="prefetch" href="/assets/js/32.3f6c49d7.js"><link rel="prefetch" href="/assets/js/33.0e76e331.js"><link rel="prefetch" href="/assets/js/34.8425f82b.js"><link rel="prefetch" href="/assets/js/35.a68d9e03.js"><link rel="prefetch" href="/assets/js/36.758c68c9.js"><link rel="prefetch" href="/assets/js/37.931b5fa8.js"><link rel="prefetch" href="/assets/js/38.54d7e83c.js"><link rel="prefetch" href="/assets/js/39.02c1c057.js"><link rel="prefetch" href="/assets/js/4.2b5d276e.js"><link rel="prefetch" href="/assets/js/40.f16546ac.js"><link rel="prefetch" href="/assets/js/41.fc4015e8.js"><link rel="prefetch" href="/assets/js/42.711bbd55.js"><link rel="prefetch" href="/assets/js/43.585f9d4b.js"><link rel="prefetch" href="/assets/js/44.048c5119.js"><link rel="prefetch" href="/assets/js/45.7a22b575.js"><link rel="prefetch" href="/assets/js/46.15940686.js"><link rel="prefetch" href="/assets/js/47.1ba303ce.js"><link rel="prefetch" href="/assets/js/48.5dc44824.js"><link rel="prefetch" href="/assets/js/49.8135b489.js"><link rel="prefetch" href="/assets/js/50.c4832626.js"><link rel="prefetch" href="/assets/js/51.4a2381a7.js"><link rel="prefetch" href="/assets/js/52.04a76fd4.js"><link rel="prefetch" href="/assets/js/53.2d4f9e57.js"><link rel="prefetch" href="/assets/js/54.e1079881.js"><link rel="prefetch" href="/assets/js/55.1d3500bb.js"><link rel="prefetch" href="/assets/js/56.2f6ab608.js"><link rel="prefetch" href="/assets/js/57.b1da280b.js"><link rel="prefetch" href="/assets/js/58.bf9ea710.js"><link rel="prefetch" href="/assets/js/9.38a030cd.js"><link rel="prefetch" href="/assets/js/search.d2763aff.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c742bf60.css">
  </head>
  <body>
    <div id="loader-wrapper" style="display: none;opacity:0">
      <div id="loader"></div>
      <div class="loader-section section-left"></div>
      <div class="loader-section section-right"></div>
    </div>
    <div id="app" data-server-rendered="true"><div data-v-8ae45032><section class="el-container" data-v-8ae45032><aside width="200px" class="el-aside menu" style="width:auto;" data-v-28ba16cc data-v-8ae45032><div class="brand-wrap" style="background-image:url(/aside.jpg);" data-v-28ba16cc><div class="brand" data-v-28ba16cc><a href="/" class="avatar waves-effect waves-circle waves-light router-link-active" data-v-28ba16cc><img src="/infoq1.png" data-v-28ba16cc></a> <hgroup class="introduce" data-v-28ba16cc><div class="nickname" data-v-28ba16cc><img src="/name.png" data-v-28ba16cc></div> <div data-v-28ba16cc><a title="253929992@qq.com" class="mail" data-v-28ba16cc>253929992@qq.com</a></div></hgroup></div></div> <ul role="menubar" class="menu-wrap el-menu" style="background-color:;" data-v-28ba16cc><li role="menuitem" aria-haspopup="true" aria-expanded="true" class="el-submenu is-opened" data-v-28ba16cc><div class="el-submenu__title" style="padding-left:20px;color:;background-color:;"><i class="iconfont icon-icon37" data-v-28ba16cc></i> <span slot="title" class="item-title" data-v-28ba16cc>自检清单</span><i class="el-submenu__icon-arrow el-icon-arrow-down"></i></div><ul role="menu" class="el-menu el-menu--inline" style="background-color:;"> <li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            JS基础
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            HTML&amp;CSS
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            计算机基础
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            数据结构和算法
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            运行环境
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            框架
          </span></li><li role="menuitem" tabindex="-1" default-active="1" class="el-menu-item" style="padding-left:40px;color:;background-color:;" data-v-28ba16cc><i class="el-icon-news" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
            工程化
          </span></li></ul></li><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-28ba16cc><i class="iconfont icon-shijianzhou" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
        时间轴
      </span></li><li role="menuitem" tabindex="-1" class="el-menu-item" style="padding-left:20px;color:;background-color:;" data-v-28ba16cc><i class="iconfont icon-guanyu" data-v-28ba16cc></i> <span class="item-title" data-v-28ba16cc>
        个人档案
      </span></li></ul></aside> <section class="el-container container-warp" data-v-8ae45032><header id="topHeader" class="el-header top-header" style="height:60px;padding-left:300px;" data-v-7e316482 data-v-8ae45032><div class="header-warp el-row is-align-center el-row--flex" data-v-7e316482><div class="el-col el-col-2 el-col-xs-7" data-v-7e316482><button type="button" class="el-button header-btn el-button--primary el-button--mini is-circle" data-v-7e316482><!----><!----><span><i class="iconfont icon-rightjustified" data-v-7e316482></i></span></button></div> <div class="el-col el-col-10 el-col-xs-24" data-v-7e316482><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-1815" class="el-autocomplete search-input" data-v-7e316482><div class="el-input el-input--small el-input--suffix"><!----><input type="text" autocomplete="off" valueKey="value" popperClass="search-popper" placeholder="搜搜看" fetchSuggestions="function () { [native code] }" debounce="300" placement="bottom-start" popperAppendToBody="true" value="" class="el-input__inner"><!----><span class="el-input__suffix"><span class="el-input__suffix-inner"><i class="el-input__icon el-icon-search search-ico" data-v-7e316482></i><!----></span><!----></span><!----></div><div role="region" class="el-autocomplete-suggestion el-popper search-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <div class="nav-col el-col el-col-8 el-col-offset-10 el-col-xs-24" data-v-7e316482><ul role="menubar" class="header-menu el-menu--horizontal el-menu" style="background-color:transparent;" data-v-7e316482><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:#fdf5ab;border-bottom-color:transparent;background-color:transparent;" data-v-7e316482>Home</li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:#ffd04b;border-bottom-color:#ffd04b;background-color:transparent;" data-v-7e316482>Blog</li></ul></div></div></header> <main class="el-main my-main" style="margin-left:238px;" data-v-47f536a8 data-v-8ae45032><div class="content-header index-header" style="background-image:url(/banner.jpg);" data-v-1ba67baf data-v-47f536a8><div class="container" data-v-1ba67baf><h1 id="conentHeader" class="title animated fadeInDown" data-v-1ba67baf>作用域和闭包</h1> <h5 class="subtitle" data-v-1ba67baf>最后更新时间：2019-10-21 11:26:01</h5> <div class="el-row is-align-center el-row--flex" data-v-47f536a8><div class="tag-card el-col el-col-20 el-col-xs-23 el-col-sm-22 el-col-md-22 el-col-lg-20" data-v-47f536a8><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>实现轮子</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Vue组件通信</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>CSS</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Vue</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>实用库</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>网络协议</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>开发和测试</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>编译原理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Nginx</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>编码能力</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>数据流管理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>浏览器API</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>版本控制</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>浏览器原理</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>持续集成</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>React</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>项目构建</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>HTML</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>开发提速</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>数据结构</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>手写</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>算法</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>设计模式</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>多端开发</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>TypeScript</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Angular</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>Node</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>变量和类型</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>执行机制</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>作用域和闭包</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>语法和API</span><span class="animated fadeInRight el-tag el-tag--medium is-hit" data-v-47f536a8>原型和原型链</span></div></div></div></div> <div data-v-3a18dd0a data-v-47f536a8 data-v-47f536a8><div class="post-content el-row is-justify-center el-row--flex" data-v-3a18dd0a><div id="post-card" class="post-card post-sign el-col el-col-16 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-3a18dd0a><div class="content__default" data-v-3a18dd0a><h2 id="_1-理解词法作用域和动态作用域。"><a href="#_1-理解词法作用域和动态作用域。" aria-hidden="true" class="header-anchor">#</a> 1. 理解词法作用域和动态作用域。</h2> <h3 id="什么是词法作用域？"><a href="#什么是词法作用域？" aria-hidden="true" class="header-anchor">#</a> 什么是词法作用域？</h3> <p><strong>词法作用域：</strong> 是定义在词法阶段的作用域，换句话说，词法作用域是由你在写代码时将变量和函数作用域写在哪里来决定的。</p> <p>因此当词法分析器处理代码时会保持作用域不变。词法作用域即<strong>静态作用域</strong>。</p> <p><strong>动态作用域：</strong> 需要明确的是，JavaScript 并不具有动态作用域，它只有词法作用域，简单明了。</p> <p><strong><code>this</code> 的执行机制表现的像动态作用域，因为 <code>this</code> 的绑定是在代码执行时确定的。</strong></p> <p>所谓 <strong><code>动态作用域</code></strong> 是指作用域在代码执行之前都不确定，也就是说拥有动态作用域的编程语言，函数的作用域是在函数调用的时候才决定的。</p> <p>为什么说 JavaScript 没有动态作用域？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 输出结果是？</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>假设 JavaScript 采用动态作用域，让我们分析下执行过程：</p> <p>执行 <code>foo()</code>时 ，依然是从 <code>foo</code> 函数内部查找是否有局部变量 <code>num</code>。如果没有，就会顺着调用栈在调用 <code>foo</code> 函数的位置，也就是 <code>bar</code> 函数内部查找 <code>num</code> 变量，结果会打印 <code>2</code>。</p> <p>而上段代码的输出结果是 <code>1</code>，在执行 <code>foo()</code> 时，先从 <code>foo</code> 函数内部查找是否有局部变量 <code>num</code>，如果没有，就根据书写的位置，查找上一层层的代码，找到了 <code>var num = 1</code>，所以结果会打印 1。所以 JavaScript 采用的是静态作用域，作用域在书写代码时就已经决定了<strong>与调用位置没有关系。</strong></p> <p>总结：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>JavaScript 只有词法作用域，词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>思考：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_2-理解-javascript-的作用域和作用域链。"><a href="#_2-理解-javascript-的作用域和作用域链。" aria-hidden="true" class="header-anchor">#</a> 2. 理解 JavaScript 的作用域和作用域链。</h2> <p><strong>作用域：</strong> JavaScript 中的作用域就是词法作用域(事实上大部分语言都是基于词法作用域的)。</p> <p><code>词法作用域</code>是一套关于引擎如何寻找变量以及会在何处找到变量的规则。</p> <p><code>词法作用域</code>最重要的特征是<strong>它的定义过程发生在代码的书写阶段</strong>(假设你没有使用 <code>eval()</code> 或 <code>with</code>)。</p> <p><strong>作用域链：</strong> 当在查找变量时，首先会在当前作用域中进行查找，如果没有找到，就会向上级进行查找，直到全局作用域。这个过程形成的关系链就是作用域。</p> <p>如下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">bar</span><span class="token punctuation">(</span>b <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在上段代码中，引擎执行 <code>console.log()</code> 声明，并查找 <code>a</code>、<code>b</code> 和 <code>c</code> 三个变量的引用。它首先从最内部的作用域，也就是 <code>bar()</code> 函数的作用域开始查找，引擎首先这里找到了<code>c</code>，而无法在这里找到 <code>a</code>，因此会去上一级到所嵌套的 <code>foo()</code> 的作用域中继续查找，在<code>foo()</code> 中查找到了<code>b</code>，而扔没有找到 <code>a</code>的引用， 因此引擎会继续去上一级（这级是全局作用域）继续查找，最后在找到了 <code>a</code>。最后经过一些列的向上查找，得到最后的输出结果 <code>1, 2, 6</code>。</p> <p><strong>注意：</strong>
词法作用域查找只会查找<strong>一级标识符</strong>，如果代码中引用了 <code>foo.bar.baz</code>，词法作用域查找只会试图查找 <code>foo</code> 标识符，找到这个变量后，对象属性访问规则会分别接管对 <code>bar</code> 和 <code>baz</code> 属性的访问。</p> <p><img src="https://i.loli.net/2019/09/23/BTSID9FgkGLid45.png" alt="屏幕快照 2019-09-23 下午4.25.28.png"></p> <p><strong>思考如下代码：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
    bar<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">baz</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_3-理解-javascript-的执行上下文。"><a href="#_3-理解-javascript-的执行上下文。" aria-hidden="true" class="header-anchor">#</a> 3. 理解 JavaScript 的执行上下文。</h2> <h4 id="什么是执行上下文？"><a href="#什么是执行上下文？" aria-hidden="true" class="header-anchor">#</a> 什么是执行上下文？</h4> <p>当函数执行时，会创建一个称为执行上下文的变量对象<code>可理解为作用域</code>。一个执行上下文定义了一个函数执行时的环境。</p> <p><code>执行上下文</code>也分为两种类型：</p> <ul><li><p>**全局执行上下文：**代码首次执行时候的默认环境，在代码的整个执行过程中，只用一个全局执行上下文。</p></li> <li><p>**函数执行上下文：**每当执行流程进入到一个函数体内部的时候，就会创建一个函数执行上下文，<code>可以有任意数量的函数执行上下文</code>。</p></li></ul> <p><strong>执行上下文主要有两个阶段：</strong> <code>创建阶段</code>和<code>执行阶段</code>。</p> <p><strong>创建阶段：</strong></p> <ul><li><p>首先，为每个函数或变量创建与外部环境的连接，这这个连接形成<code>作用域链</code>。<code>作用链</code>告诉执行上下文它应该包含什么，以及它应该在哪里查找解析函数的引用和变量的值。</p></li> <li><p>扫描<code>作用链</code>后，将创建一个环境存储器，其中<code>全局上下文</code>、<code>变量</code>、<code>函数及函数参数</code>的创建和引用在内存中完成。</p></li> <li><p>最后，在第一步中创建的每个执行上下文中确定 <code>this</code> 关键字的值。</p></li></ul> <p><strong>每个执行上下文包含了三个重要属性：<code>变量对象（VO）</code>、<code>作用域链</code>、<code>this</code>。</strong></p> <p>创建阶段伪代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>createContext <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 创建阶段</span>
  <span class="token string">'outerEnvironmentConnection'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 创建外部连接</span>
        <span class="token comment">// 形成作用域链</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>    
   <span class="token string">'variableObjectMapping'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 变量、函数和函数参数的创建和引用在内存中完成。</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token string">'valueOfThis'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 确定 this 的值</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>执行阶段：</strong></p> <p><code>执行阶段</code>是代码在创建阶段形成的执行上下文中的运行的阶段，并且逐行分配变量值。</p> <p>当执行开始时，JavaScript 引擎在其创建阶段形成的<code>AO对象</code>中查找执行函数的引用。如果在当前对象中没有找到，它将沿着作用域继续向上查找，直到它到达全局环境。</p> <p>如果在全局环境中找不到函数引用，则将返回错误。</p> <p>如果找到了引用并且函数正确执行，那么这个特定函数的执行上下文将从栈中弹出，接着 JavaScript 引擎将移动到下一个函数，它们的函数执行上下文将被加入到栈中并执行，以此类推。</p> <p>下面结合代码来理解<code>两种执行上下文</code>的<code>两个阶段</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;webinfoq&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token string">&quot;execution context&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> author <span class="token operator">=</span> <span class="token string">&quot;deepak&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">func2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num <span class="token operator">*</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> fixed <span class="token operator">=</span> <span class="token string">&quot;Divine&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">addFive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">func1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>因此<code>全局执行上下文</code>的<code>创建阶段</code>将如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>globalExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// 全局执行上下文</span>
    outerEnvironmentConnection<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// 全局上下文外部环境为 null</span>
    variableObjectMapping<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
        name<span class="token punctuation">:</span> uninitialized<span class="token punctuation">,</span>  <span class="token comment">// 在创建阶段，let 声明的变量是未初始化状态</span>
        title<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>     <span class="token comment">// 在创建阶段，var 声明的变量表示为未定义</span>
        date<span class="token punctuation">:</span> uninitialized<span class="token punctuation">,</span>  <span class="token comment">// 在创建阶段，const 声明的变量是未初始化状态</span>
        func1<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;func1 reference&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  <span class="token comment">// func1 地址引用</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">:</span> window <span class="token comment">// Global Object  </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在<code>执行阶段</code>完成对变量的赋值等操作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>globalExectutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// 全局执行上下文</span>
    outerEnvironmentConnection<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 全部上下文外部环境为 null</span>
    variableObjectMapping<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;webinfoq&quot;</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token string">&quot;execution context&quot;</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">,</span>
        func1<span class="token punctuation">:</span> pointer to <span class="token keyword">function</span> func1<span class="token punctuation">,</span> <span class="token comment">// 指向 func1 的指针</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">:</span> window <span class="token comment">//Global Object</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当执行到 <code>func1</code> 时，将形成新的<code>函数执行上下文</code>，<code>创建阶段</code>如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>func1ExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// func1 函数执行上下文</span>
    outerEnvironmentConnection<span class="token punctuation">:</span> Global<span class="token punctuation">,</span>  <span class="token comment">// 外部环境为全局环境</span>
    variableObjectMapping<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       arguments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            length<span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        num<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>  <span class="token comment">// var 声明的</span>
        value<span class="token punctuation">:</span> uninitialized<span class="token punctuation">,</span>  <span class="token comment">// let 声明的</span>
        func2<span class="token punctuation">:</span> uninitialized<span class="token punctuation">,</span>  <span class="token comment">// let 声明的</span>
        fixed<span class="token punctuation">:</span> uninitialized<span class="token punctuation">,</span>  <span class="token comment">// const 声明</span>
        addFive<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;addFive reference&gt;</span><span class="token template-punctuation string">`</span></span>  <span class="token comment">// addFive 地址引用</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">:</span> Global Object or <span class="token keyword">undefined</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>执行阶段</code>如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>func1ExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    outerEnvironmentConnection<span class="token punctuation">:</span> Global<span class="token punctuation">,</span>  
    variableObjectMapping<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       arguments<span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 先处理 arguments 参数</span>
            <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
            length<span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        num<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&quot;deepak&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//变量赋值</span>
        val<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        func2<span class="token punctuation">:</span> pointer to <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        fixed<span class="token punctuation">:</span> <span class="token string">&quot;Divine&quot;</span>
        addFive<span class="token punctuation">:</span> pointer to <span class="token keyword">function</span> <span class="token function">addFive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">:</span> Global Object or <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>最后：</strong></p> <p>Javascript 引擎创建执行上下文，调用栈。当有函数执行时，引擎就会创建一个新的函数执行上下文。最后所用函数执行完成后，将更新全局环境，然后全局代码完成，程序结束。</p> <h2 id="_4-理解-javascript-执行上下文栈，可以应用堆栈信息快速定位问题。"><a href="#_4-理解-javascript-执行上下文栈，可以应用堆栈信息快速定位问题。" aria-hidden="true" class="header-anchor">#</a> 4. 理解 JavaScript 执行上下文栈，可以应用堆栈信息快速定位问题。</h2> <p>通过阅读上一小节我们得知，每当有函数执行时，就会创建一个全新的<code>执行上下文</code>，那么怎么管理这些执行上下文呢？</p> <p>JavaScript 引擎创建了<strong>执行上下文栈</strong> <code>Execution Context Stack</code> 来管理执行上下文。</p> <p>可以把执行栈认为成一个储存函数调用的栈结构，遵循先进后出的原则。</p> <p>下图为<code>执行上下文</code>入栈出栈示意图：</p> <p><img src="https://i.loli.net/2019/09/23/twsk5g6oaOBFEVq.gif" alt="入栈出栈示意图"></p> <p><strong>JavaScript 引擎是单线程执行，所有代码都是排队执行：</strong></p> <ul><li><p>一开始执行的是全局代码，首先创建<code>全局执行上下文</code>，然后将该执行上下文压入执行栈中。</p></li> <li><p>当执行一个函数，就会创建该<code>函数执行上下文</code>，然后将其压入执行栈的顶部。</p></li> <li><p>函数执行完成后，执行上下文从底部退出，等待垃圾回收。</p></li></ul> <p><strong>调用栈的应用：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>你可以把调用栈想象成一个函数调用链，就像我们在前面代码段的注释中所写的一样。
另一个查看调用栈的方法是使用浏览器的调试工具。绝大多数现代桌面浏览器都内置了开发者工具， 其中包含 JavaScript 调试器。
就本例来说，你可以在工具中给 <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 函数的第一行代码设置一个断点，或者直接在第一行代码之前插入一条 <span class="token keyword">debugger</span> 语句。
运行代码时，调试器会在那个位置暂停，同时会展示当前位置的函数调用列表，这就是你的调用栈。
因此，如果你想要分析 <span class="token keyword">this</span> 的绑定，使用开 发者工具得到调用栈，然后找到栈中第二个元素，这就是真正的调用位置。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_5-this-的原理以及几种不同使用场景的取值。"><a href="#_5-this-的原理以及几种不同使用场景的取值。" aria-hidden="true" class="header-anchor">#</a> 5. this 的原理以及几种不同使用场景的取值。</h2> <p><strong>this</strong> 是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于<code>函数调用时</code>的各种条件。</p> <p><strong>this 的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</strong></p> <p>当一个函数被调用时，会创建一个活动记录(有时候也称为执行上下文)。这个记录会包含函数在哪里被调用(调用栈)、函数的调用方法、传入的参数等信息。<code>this</code> 就是记录的其中一个属性，会在函数执行的过程中用到。</p> <p>理解<code>调用栈</code>和<code>调用位置</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前调用栈是: baz</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;baz&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- bar 的调用位置 </span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前调用栈是 baz -&gt; bar</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- foo 的调用位置，当前调用位置在 baz 中</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前调用栈是 baz -&gt; bar -&gt; foo </span>
    <span class="token comment">// 因此，当前调用位置在 bar 中</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- baz 的调用位置，当前调用位置是全局作用域  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>this 绑定遵循以下四种规则：</strong> <code>默认绑定</code>、<code>隐式绑定</code>、<code>显示绑定</code>、<code>new 绑定</code>。</p> <h4 id="_1-默认绑定：独立函数调用，this-指向全局对象。调用时前边没有或省略-操作符号。"><a href="#_1-默认绑定：独立函数调用，this-指向全局对象。调用时前边没有或省略-操作符号。" aria-hidden="true" class="header-anchor">#</a> 1. 默认绑定：独立函数调用，<code>this</code> 指向全局对象。调用时前边没有或省略 <code>.</code> 操作符号。</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// window.a = 2;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// window.foo();</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>注意：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">如果使用严格模式</span><span class="token punctuation">(</span>strict mode<span class="token punctuation">)</span>，那么全局对象将无法使用默认绑定，因此 <span class="token keyword">this</span> 会绑定到 <span class="token keyword">undefined</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-隐式绑定：调用位置是否有上下文对象，也就是说，函数被作为某个对象的方法被调用时，this-指向那个对象。"><a href="#_2-隐式绑定：调用位置是否有上下文对象，也就是说，函数被作为某个对象的方法被调用时，this-指向那个对象。" aria-hidden="true" class="header-anchor">#</a> 2. 隐式绑定：调用位置是否有上下文对象，也就是说，函数被作为某个对象的方法被调用时，<code>this</code> 指向那个对象。</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> 
    a<span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    foo<span class="token punctuation">:</span> foo 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span> 
    a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    obj2<span class="token punctuation">:</span> obj2 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上段代码中，词法作用域只会查找最顶层的 <code>obj1</code>，按着对象属性访问规则，会在自身上查找属性 <code>obj2</code>，所以 <code>this</code> 指向 <code>obj2</code>，所以 <code>this.a</code> 等于 <code>bj2.a</code>。</p> <p><strong>对象属性引用链中只有最顶层或者说最后一层会影响调用位置。</strong></p> <p><strong>注意：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>会出现隐式丢失的情况：
<span class="token keyword">this</span> 绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说它会应用默认绑定，
从而把 <span class="token keyword">this</span> 绑定到全局对象或者 <span class="token keyword">undefined</span> 上，取决于是否是严格模式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3-显示绑定：使用-call、apply-或者-bind-绑定到指定的对象。this指向传入的第一个参数。"><a href="#_3-显示绑定：使用-call、apply-或者-bind-绑定到指定的对象。this指向传入的第一个参数。" aria-hidden="true" class="header-anchor">#</a> 3. 显示绑定：使用 <code>call</code>、<code>apply</code> 或者 <code>bind</code> 绑定到指定的对象。<strong>this指向传入的第一个参数。</strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> 
    a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span> bar<span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token comment">// 硬绑定的 bar 不可能再修改它的 this </span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> window <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>注意：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>把 <span class="token keyword">null</span> 或者 <span class="token keyword">undefined</span> 作为 <span class="token keyword">this</span> 的绑定对象传入 call、apply 或者 bind，这些值
在调用时会被忽略，实际应用的是默认绑定规则。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-new-绑定：this-指向创建的空对象-。"><a href="#_4-new-绑定：this-指向创建的空对象-。" aria-hidden="true" class="header-anchor">#</a> 4. <code>new</code> 绑定：<code>this</code> 指向创建的空对象 <code>{}</code>。</h4> <p>使用 <code>new</code> 来调用函数，或者说发生构造函数调用时，会自动执行下面的操作：</p> <ol><li><p>创建(或者说构造)一个全新的对象。</p></li> <li><p>这个新对象会被执行<code>[[proto]]</code>连接。</p></li> <li><p>这个新对象会绑定到函数调用的 <code>this</code>。</p></li> <li><p>如果函数没有返回其他对象，那么 <code>new</code> 表达式中的函数调用会自动返回这个新对象。</p></li></ol> <h5 id="总结：关于-this-绑定的场景，遵循以下-4-条规则："><a href="#总结：关于-this-绑定的场景，遵循以下-4-条规则：" aria-hidden="true" class="header-anchor">#</a> 总结：关于 <code>this</code> 绑定的场景，遵循以下 <code>4</code> 条规则：</h5> <ol><li><p>由 <code>new</code> 调用? 绑定到新创建的对象。</p></li> <li><p>由<code>call</code>或者 <code>apply</code> 或者 <code>bind</code> 调用? 绑定到<strong>指定的对象</strong>。</p></li> <li><p>由上下文对象调用? 绑定到那个上下文对象。</p></li> <li><p>在严格模式下绑定到 <code>undefined</code>，否则绑定到<strong>全局对象</strong>。</p></li></ol> <h5 id="拓展："><a href="#拓展：" aria-hidden="true" class="header-anchor">#</a> 拓展：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>绑定优先级：new 绑定 &gt; 硬绑定 &gt; 隐式绑定 &gt; 默认绑定
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><em>本节参考：你不知道的 JavaScript（上卷）</em></p> <h2 id="_6-闭包的实现原理和作用，可以列举几个开发中闭包的实际应用。"><a href="#_6-闭包的实现原理和作用，可以列举几个开发中闭包的实际应用。" aria-hidden="true" class="header-anchor">#</a> 6. 闭包的实现原理和作用，可以列举几个开发中闭包的实际应用。</h2> <h5 id="闭包的概念：闭包是可以记住并有权访问所在函数作用域的函数，即使这个函数是在当前函数作用域之外执行。"><a href="#闭包的概念：闭包是可以记住并有权访问所在函数作用域的函数，即使这个函数是在当前函数作用域之外执行。" aria-hidden="true" class="header-anchor">#</a> 闭包的概念：闭包是可以记住并有权访问所在函数作用域的<code>函数</code>，即使这个<code>函数</code>是在当前函数作用域之外执行。</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">closure</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> closure <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">closure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这段代码中，调用 <code>add()</code> 时会生成一个函数执行上下文，并推入到<code>执行上下文栈中</code>。
<code>add</code> 函数执行完毕后，它的执行上下文会从执行栈中推出，同时局部变量 <code>a</code> 会被清理才对，但我们在执行 <code>console.log(closure(1));</code>时却输出了结果 <code>2</code>。</p> <p>我们发现，调用<code>add()</code>时，会返回一个函数 <code>ƒ closure(b) { return a + b; }</code>，说明局部变量 <code>a</code> 存储于 <code>closure</code> 函数作用域中，因此我们能得到结果 <code>2</code>。</p> <p>返回的这个函数 <code>ƒ closure(b) { return a + b; }</code> 就是我们将要介绍的 <strong><code>闭包</code></strong>。</p> <h3 id="闭包的实现原理"><a href="#闭包的实现原理" aria-hidden="true" class="header-anchor">#</a> 闭包的实现原理</h3> <h5 id="闭包是如何实现对外部作用域的变量存储的？"><a href="#闭包是如何实现对外部作用域的变量存储的？" aria-hidden="true" class="header-anchor">#</a> 闭包是如何实现对外部作用域的变量存储的？</h5> <p>**我们需要先搞清楚：**它是拷贝了变量 <code>a</code> 的值到其作用域中，还是 <code>a</code> 压根没有被销毁，而是给了闭包 <code>closure</code> 访问的权限。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>a<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">closure</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> closure <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">closure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>首先，我们在这段代码 <code>++a</code> 处打上断点，看下实际执行情况。</p> <p><img src="https://i.loli.net/2019/09/24/Raiyz5VeuqWP6jD.png" alt="屏幕快照 2019-09-24 下午2.57.06.png"><img src="https://i.loli.net/2019/09/24/p4urbaPhGJA1fxi.png" alt="屏幕快照 2019-09-24 下午2.53.13.png"></p> <p>我们发现调用栈为 <code>add</code>，在执行到断点处时，作用域对象 <code>Scope</code> 中存储了当前局部变量 <code>a</code> 的值为 <code>2</code>，这是我们预期的结果。</p> <p>接着我们在代码 <code>return a + b;</code> 处打上断点，实际情况如下图所示：</p> <p><img src="https://i.loli.net/2019/09/24/itPuok97KMTNBfD.png" alt="屏幕快照 2019-09-24 下午3.06.28.png"><img src="https://i.loli.net/2019/09/24/SYpT7jrPiD8oBEV.png" alt="屏幕快照 2019-09-24 下午2.49.18.png"></p> <p>从 <code>Debug</code> 的结果来看，当执行到断点 <code>return a + b;</code> 处时，调用栈 <code>add</code> 被推出，当前调用栈变成了 <code>closure</code>，作用域对象 <code>Scope</code> 中局部变量 <code>a</code> 被销毁，只保存了当前调用栈 <code>closure</code> 中的变量 <code>b</code>。</p> <p>而运行到此时，多出了一个 <code>Closure</code> 对象，它持有所在作用域 <code>add</code> 中的局部变量 <code>a</code> 属性，它的值为 <code>2</code>。</p> <p>**这里我们应该能得知：**它是拷贝了变量 <code>a</code> 的值到其作用域中进而给了闭包 <code>closure</code> 访问的权限。</p> <p><strong>总结：</strong></p> <p>JavaScript 在执行时，如果遇到上述含有 <code>闭包</code> 的代码，它会在内存开辟出一块空间，这个内存空间称为 <code>Closure</code> 对象，<strong>它用来存储所在函数作用域中的变量，因此其所在作用域的变量即使被销毁，在外部也能访问到存储下来的变量。</strong></p> <p><em><strong>闭包查找变量是沿着作用域链向上查找的，本文并没有介绍的作用域链相关的知识，因为个人感觉闭包能缓存变量的原理并不是因为作用域链，作用域链只能说明闭包访问的范围。</strong></em></p> <h3 id="闭包的应用场景"><a href="#闭包的应用场景" aria-hidden="true" class="header-anchor">#</a> 闭包的应用场景</h3> <ul><li><strong>jQuery</strong> 源码的实现（ jQuery 就是一个大的闭包 ）。</li> <li>函数节流。</li> <li><strong>Ajax</strong> 的回调函数。</li> <li>处理循环中的异步操作。</li></ul> <h2 id="_7-理解堆栈溢出和内存泄漏的原理，如何防止？"><a href="#_7-理解堆栈溢出和内存泄漏的原理，如何防止？" aria-hidden="true" class="header-anchor">#</a> 7. 理解堆栈溢出和内存泄漏的原理，如何防止？</h2> <h2 id="_8-如何处理循环的异步操作？"><a href="#_8-如何处理循环的异步操作？" aria-hidden="true" class="header-anchor">#</a> 8. 如何处理循环的异步操作？</h2> <p>在实际项目中，我们可能会遇到，在循环中发起接口调用的请求，就像这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> parmas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;todos/1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;todos/2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;todos/3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token string">'https://jsonplaceholder.typicode.com'</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parmas<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>urls <span class="token operator">+</span> $<span class="token punctuation">{</span>parmas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="async-await"><a href="#async-await" aria-hidden="true" class="header-anchor">#</a> async await</h4> <p>#####1. 串行执行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> urls <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'https://jsonplaceholder.typicode.com/todos/1'</span><span class="token punctuation">,</span>
  <span class="token string">'https://jsonplaceholder.typicode.com/todos/2'</span><span class="token punctuation">,</span>
  <span class="token string">'https://jsonplaceholder.typicode.com/todos/3'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> urls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="_2-并行执行："><a href="#_2-并行执行：" aria-hidden="true" class="header-anchor">#</a> 2. 并行执行：</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 第一种</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promises <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> promise <span class="token keyword">of</span> promises<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> promise
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 第二种</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promises <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_9-理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理。"><a href="#_9-理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理。" aria-hidden="true" class="header-anchor">#</a> 9. 理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理。</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <span id="footerPost" data-v-3a18dd0a></span></div> <div id="post-toc" class="post-toc el-col el-col-6" data-v-3a18dd0a><div class="catalog-body" data-v-3a18dd0a><h4 class="catalog-title" data-v-3a18dd0a>目录</h4> <ul id="catalog-list" class="catalog-list" data-v-3a18dd0a></ul></div></div></div> <div class="el-row is-justify-center el-row--flex" data-v-3a18dd0a><div class="post-card vssue-wrap el-col el-col-21 el-col-xs-24 el-col-sm-23 el-col-md-23 el-col-lg-16" data-v-3a18dd0a></div></div> <div class="post-nav el-row is-justify-space-around el-row--flex" data-v-3a18dd0a><div class="post-prev el-col el-col-7" data-v-3a18dd0a><div data-v-3a18dd0a><a href="/posts/Chapter1/%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6.html" data-v-3a18dd0a><i class="el-icon-arrow-left" data-v-3a18dd0a></i> Prev
        </a> <p class="nav-title" data-v-3a18dd0a>执行机制</p></div></div> <div class="post-next el-col el-col-7 el-col-lg-pull-5" data-v-3a18dd0a><div data-v-3a18dd0a><a href="/posts/Chapter1/%E8%AF%AD%E6%B3%95%E5%92%8CAPI.html" data-v-3a18dd0a>
          Next
          <i class="el-icon-arrow-right" data-v-3a18dd0a></i></a> <p class="nav-title" data-v-3a18dd0a>语法和API</p></div></div></div> <span data-v-3f1acc1c data-v-3a18dd0a><button type="button" class="el-button toc-btn el-button--primary el-button--mini is-circle" data-v-3f1acc1c><!----><!----><span><i class="el-icon-tickets" data-v-3f1acc1c></i></span></button> <button type="button" class="el-button gotop-btn el-button--primary is-circle" data-v-3f1acc1c><!----><!----><span><i class="el-icon-arrow-up" data-v-3f1acc1c></i></span></button></span></div></main></section> <button type="button" class="el-button gotop-btn el-button--primary is-circle" style="display:none;" data-v-1918517c data-v-8ae45032><!----><!----><span><i class="el-icon-arrow-up" data-v-1918517c></i></span></button></section> <div class="overlay" data-v-8ae45032></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1fed3379.js" defer></script><script src="/assets/js/1.1ddbcd0b.js" defer></script><script src="/assets/js/6.4b004479.js" defer></script><script src="/assets/js/5.4c567fbe.js" defer></script><script src="/assets/js/8.eae040db.js" defer></script><script src="/assets/js/11.4e97cf26.js" defer></script><script src="/assets/js/7.5e624306.js" defer></script><script src="/assets/js/26.8893ec62.js" defer></script><script src="/assets/js/16.737902ee.js" defer></script>
  </body>
</html>
